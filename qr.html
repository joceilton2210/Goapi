<!DOCTYPE html>

<html class="dark" lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    
    <!-- SEO Meta Tags -->
    <title>Conectar Instância WhatsApp - GO API WhatsApp Manager</title>
    <meta name="description" content="Conecte sua instância do WhatsApp à GO API. Gerencie mensagens, automações e integrações de forma profissional e segura. QR Code rápido e fácil.">
    <meta name="keywords" content="WhatsApp API, GO API, conectar WhatsApp, instância WhatsApp, QR Code WhatsApp, automação WhatsApp, API mensagens">
    <meta name="author" content="Time GO - Nakamura, Joceilton Gomes, Othon Righetti">
    <meta name="robots" content="index, follow">
    <meta name="language" content="pt-BR">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="qr.html">
    <meta property="og:title" content="Conectar Instância WhatsApp - GO API">
    <meta property="og:description" content="Conecte sua instância do WhatsApp à GO API. Gerencie mensagens e automações de forma profissional.">
    <meta property="og:image" content="logo.png">
    <meta property="og:site_name" content="GO API WhatsApp">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="qr.html">
    <meta name="twitter:title" content="Conectar Instância WhatsApp - GO API">
    <meta name="twitter:description" content="Conecte sua instância do WhatsApp à GO API. Gerencie mensagens e automações de forma profissional.">
    <meta name="twitter:image" content="logo.png">
    
    <!-- Favicons -->
    <link rel="icon" type="image/png" sizes="32x32" href="logo.png">
    <link rel="icon" type="image/png" sizes="16x16" href="logo.png">
    <link rel="apple-touch-icon" sizes="180x180" href="logo.png">
    <link rel="shortcut icon" href="logo.png" type="image/x-icon">
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&amp;display=swap"
        rel="stylesheet" />
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
        rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <!-- Global Config -->
    <script src="assets/js/config.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <!-- Custom Alert System -->
    <script src="assets/js/alert.js"></script>
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#eaa800",
                        "background-light": "#f6f6f8",
                        "background-dark": "#101622",
                    },
                    fontFamily: {
                        "display": ["Inter", "sans-serif"]
                    },
                    borderRadius: { "DEFAULT": "0.25rem", "lg": "0.5rem", "xl": "0.75rem", "full": "9999px" },
                },
            },
        }
    </script>
</head>

<body class="font-display bg-gray-50 dark:bg-background-dark text-slate-900 dark:text-white overflow-x-hidden">
    <div class="relative flex h-auto min-h-screen w-full flex-col group/design-root">
        <!-- Top Navigation Bar -->
         <!-- Top Navigation -->
    <header
        class="border-b border-solid border-border-light dark:border-border-dark bg-surface-light dark:bg-surface-dark sticky top-0 z-50">
        <div class="flex items-center justify-center py-3 px-4 md:px-10 lg:px-20">
            <div class="flex items-center justify-between w-full max-w-[1200px]">
                <div class="flex items-center gap-6 text-slate-900 dark:text-white">
                    <img src="logo_black.png" alt="GO API Logo" class="h-12 w-auto object-contain dark:hidden">
                    <img src="logo_white.png" alt="GO API Logo" class="h-12 w-auto object-contain hidden dark:block">
                    <a href="instancia.html"
                        class="hidden md:block text-text-secondary-light dark:text-text-secondary-dark hover:text-white transition-colors text-sm font-medium">
                        Dashboard
                    </a>
                    <a href="documentacao.html"
                        class="hidden md:block text-primary font-semibold text-sm">
                        Documentação
                    </a>
                    <a href="integracao.html"
                        class="hidden md:block text-text-secondary-light dark:text-text-secondary-dark hover:text-white transition-colors text-sm font-medium">
                        Integração
                    </a>
                    <a href="envio.html"
                        class="hidden md:block text-primary font-semibold text-sm">
                        Enviar Mensagens
                    </a>
                </div>
                <div class="flex gap-6 items-center">
                    <button id="theme-toggle"
                        class="text-text-secondary-light dark:text-text-secondary-dark hover:text-white transition-colors">
                        <span class="material-symbols-outlined dark:hidden">light_mode</span>
                        <span class="material-symbols-outlined hidden dark:inline">dark_mode</span>
                    </button>
                    <!-- Language Dropdown -->
                    <div class="relative">
                        <button id="language-toggle"
                            class="flex items-center gap-2 px-3 py-1.5 text-text-secondary-light dark:text-text-secondary-dark hover:text-white transition-colors text-sm font-semibold rounded-lg hover:bg-surface-dark">
                            <span class="material-symbols-outlined text-[18px]">language</span>
                            <span id="current-lang-text">PT</span>
                            <span class="material-symbols-outlined text-[14px]">expand_more</span>
                        </button>
                        
                        <!-- Dropdown Menu -->
                        <div id="language-dropdown"
                            class="hidden absolute top-full right-0 mt-2 w-44 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-xl overflow-hidden z-50">
                            <button onclick="selectLanguage('pt')"
                                class="w-full flex items-center gap-2 px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors text-left">
                                <span><img src="bra.png" alt="Bandeira Brasil" class="w-5 h-5 object-cover rounded"></span>
                                <span class="text-sm font-medium text-gray-700 dark:text-gray-200">Português</span>
                            </button>
                            <button onclick="selectLanguage('en')"
                                class="w-full flex items-center gap-2 px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors text-left">
                                <span><img src="usa.png" alt="Bandeira EUA" class="w-5 h-5 object-cover rounded"></span>
                                <span class="text-sm font-medium text-gray-700 dark:text-gray-200">English</span>
                            </button>
                            <button onclick="selectLanguage('es')"
                                class="w-full flex items-center gap-2 px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors text-left">
                                <span><img src="esp.png" alt="Bandeira Espanha" class="w-5 h-5 object-cover rounded"></span>
                                <span class="text-sm font-medium text-gray-700 dark:text-gray-200">Español</span>
                            </button>
                        </div>
                    </div>
                    <div class="h-8 w-[1px] bg-border-light dark:bg-border-dark"></div>
                    <div class="flex items-center gap-3">
                        <div class="text-right hidden sm:block">
                            <p class="text-sm font-semibold">Admin User</p>
                            <p class="text-xs text-text-secondary-light dark:text-text-secondary-dark">Pro Plan</p>
                        </div>
                        <div class="bg-center bg-no-repeat bg-cover rounded-full size-10 border-2 border-primary"
                            data-alt="User profile picture placeholder"
                            style='background-image: url("icone.png");'>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>
        <div class="layout-container flex h-full grow flex-col">
            <div class="px-4 md:px-10 lg:px-40 flex flex-1 justify-center py-10">
                <div class="layout-content-container flex flex-col max-w-[1200px] flex-1">
                    <!-- Page Heading -->
                    <div class="flex flex-wrap justify-between gap-3 p-4 mb-4">
                        <div class="flex min-w-72 flex-col gap-3">
                            <div class="flex items-center gap-3">
                                <h1
                                    class="text-slate-900 dark:text-white text-4xl font-black leading-tight tracking-[-0.033em]" data-i18n="page-title">
                                    Connect Instance #42</h1>
                                <span
                                    class="px-3 py-1 bg-yellow-500/10 text-yellow-600 dark:text-yellow-400 rounded-full text-xs font-bold border border-yellow-500/20" data-i18n="status-badge">Disconnected</span>
                            </div>
                            <p class="text-slate-600 dark:text-slate-300 text-base font-normal leading-normal" data-i18n="page-subtitle">
                                Scan the QR code below to link your WhatsApp account to this API instance.
                            </p>
                        </div>
                    </div>
                    <!-- Main Content Area: Instructions + QR Code -->
                    <div class="p-4">
                        <div
                            class="flex flex-col lg:flex-row gap-8 items-start bg-white dark:bg-[#192233] rounded-xl shadow-sm border border-gray-200 dark:border-[#232f48] p-8 lg:p-12">
                            <!-- Left Column: Instructions -->
                            <div class="flex flex-1 flex-col gap-8">
                                <div class="flex flex-col gap-2">
                                    <h2 class="text-slate-900 dark:text-white text-2xl font-bold leading-tight" data-i18n="instructions-title">
                                        Instructions</h2>
                                    <p class="text-slate-600 dark:text-slate-300 text-base" data-i18n="instructions-subtitle">Follow these steps on your
                                        mobile device:</p>
                                </div>
                                <div class="flex flex-col gap-6">
                                    <div class="flex gap-4 items-start">
                                        <span
                                            class="flex items-center justify-center size-8 rounded-full bg-primary/10 text-primary font-bold text-sm shrink-0">1</span>
                                        <div class="flex flex-col gap-1">
                                            <p
                                                class="text-slate-900 dark:text-white text-base font-medium leading-normal" data-i18n="step1-title">
                                                Open WhatsApp</p>
                                            <p
                                                class="text-slate-600 dark:text-slate-300 text-sm font-normal leading-normal" data-i18n="step1-desc">
                                                Open WhatsApp on your mobile phone.</p>
                                        </div>
                                    </div>
                                    <div class="flex gap-4 items-start">
                                        <span
                                            class="flex items-center justify-center size-8 rounded-full bg-primary/10 text-primary font-bold text-sm shrink-0">2</span>
                                        <div class="flex flex-col gap-1">
                                            <p
                                                class="text-slate-900 dark:text-white text-base font-medium leading-normal" data-i18n="step2-title">
                                                Go to Settings</p>
                                            <p
                                                class="text-slate-600 dark:text-slate-300 text-sm font-normal leading-normal" data-i18n="step2-desc">
                                                Tap <span class="font-bold">Menu</span> on Android or <span
                                                    class="font-bold">Settings</span> on iOS.</p>
                                        </div>
                                    </div>
                                    <div class="flex gap-4 items-start">
                                        <span
                                            class="flex items-center justify-center size-8 rounded-full bg-primary/10 text-primary font-bold text-sm shrink-0">3</span>
                                        <div class="flex flex-col gap-1">
                                            <p
                                                class="text-slate-900 dark:text-white text-base font-medium leading-normal" data-i18n="step3-title">
                                                Select Linked Devices</p>
                                            <p
                                                class="text-slate-600 dark:text-slate-300 text-sm font-normal leading-normal" data-i18n="step3-desc">
                                                Tap on <span class="font-bold">Linked Devices</span> and then <span
                                                    class="font-bold">Link a Device</span>.</p>
                                        </div>
                                    </div>
                                    <div class="flex gap-4 items-start">
                                        <span
                                            class="flex items-center justify-center size-8 rounded-full bg-primary/10 text-primary font-bold text-sm shrink-0">4</span>
                                        <div class="flex flex-col gap-1">
                                            <p
                                                class="text-slate-900 dark:text-white text-base font-medium leading-normal" data-i18n="step4-title">
                                                Scan QR Code</p>
                                            <p
                                                class="text-slate-600 dark:text-slate-300 text-sm font-normal leading-normal" data-i18n="step4-desc">
                                                Point your phone at this screen to capture the code.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Right Column: QR Code Card -->
                            <div class="w-full lg:w-auto flex justify-center">
                                <div
                                    class="flex flex-col items-center gap-6 bg-[#f6f6f8] dark:bg-[#111722] p-8 rounded-xl border border-[#e5e7eb] dark:border-[#232f48] max-w-[360px] w-full shadow-inner">
                                    <div class="relative group">
                                        <!-- QR Container -->
                                        <div class="bg-white p-4 rounded-lg shadow-sm">
                                            <img alt="QR Code for WhatsApp Connection"
                                                class="w-[250px] h-[250px] object-contain opacity-100 transition-opacity duration-300"
                                                data-alt="Black and white QR code pattern for scanning"
                                                src="https://lh3.googleusercontent.com/aida-public/AB6AXuDnoG-LqCFy9lxWlZQCk1UyztO3tjqO1w6Oyi8GWk7agN5x4OIVWJpc3xpZdRvp3wR7FECImDxIkeGHfVSfi0_uyKDwmIXPgbM6hHOpp5NKfPS4Sie6g0mBjxDtaPurYz_qE-f50dnISemqewGJh8Ox_3pQ5n1_JbkaivsxjjsYKNgJZO8xW8cQgPzXLpbJUTgyt_s1a-0hqU6V4KndfAM4OIyXIhn67ymH7QCie9HcfhePVOFDcm3mSyU_LTNPN7hPEvVPWdBNwBxT" />
                                            <!-- Logo Overlay -->
                                            <div
                                                class="absolute inset-0 flex items-center justify-center pointer-events-none">
                                                <div class="bg-white p-1 rounded-full shadow-sm">
                                                    <div
                                                        class="size-10 bg-[#25D366] rounded-full flex items-center justify-center text-white">
                                                        <span class="material-symbols-outlined text-[24px]">call</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- Expired Overlay (Hidden by default, shown for design demo purposes on hover/state) -->
                                        <!-- <div class="absolute inset-0 bg-white/90 backdrop-blur-sm flex flex-col items-center justify-center gap-3 rounded-lg opacity-0 hover:opacity-100 transition-opacity duration-300 cursor-pointer">
                                        <div class="bg-primary/10 p-3 rounded-full text-primary">
                                            <span class="material-symbols-outlined">refresh</span>
                                        </div>
                                        <p class="text-sm font-bold text-[#111722]">Click to reload</p>
                                    </div> -->
                                    </div>
                                    <div class="flex flex-col items-center gap-3 w-full">
                                        <div id="qr-status" class="flex items-center gap-2 text-slate-600 dark:text-slate-300">
                                            <span class="relative flex h-3 w-3">
                                                <span
                                                    class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                                                <span
                                                    class="relative inline-flex rounded-full h-3 w-3 bg-green-500"></span>
                                            </span>
                                            <p class="text-sm font-medium">Aguardando leitura...</p>
                                        </div>
                                        <button id="reload-qr-btn"
                                            class="w-full flex cursor-pointer items-center justify-center gap-2 overflow-hidden rounded-lg h-10 px-4 bg-primary text-slate-900 text-sm font-bold leading-normal hover:bg-white hover:text-slate-900 transition-all shadow-md shadow-primary/20">
                                            <span class="material-symbols-outlined text-[18px]">refresh</span>
                                            <span class="truncate" data-i18n="reload-qr">Recarregar QR Code</span>
                                        </button>
                                        <button id="share-qr-btn"
                                            class="w-full flex cursor-pointer items-center justify-center gap-2 overflow-hidden rounded-lg h-10 px-4 bg-blue-600 text-white text-sm font-bold leading-normal hover:bg-blue-700 transition-all shadow-md">
                                            <span class="material-symbols-outlined text-[18px]">share</span>
                                            <span class="truncate">Compartilhar Link</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Footer / Troubleshooting -->
                    <div class="p-4 flex flex-col items-center gap-4">
                        <div
                            class="flex items-center gap-2 text-yellow-600 dark:text-yellow-500 bg-yellow-50 dark:bg-yellow-900/20 px-4 py-2 rounded-lg border border-yellow-200 dark:border-yellow-900/30">
                            <span class="material-symbols-outlined text-sm">lightbulb</span>
                            <p class="text-sm font-medium" data-i18n="tip">Tip: Keep your phone connected to the internet.</p>
                        </div>
                        <a class="text-slate-600 dark:text-slate-300 text-sm font-normal leading-normal hover:text-primary underline decoration-1 underline-offset-4 transition-all"
                            href="#" data-i18n="help-link">
                            Need help? Check our connection troubleshooting guide.
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
  <!-- Footer Bar - Full Width -->
    <footer class="fixed bottom-0 left-0 right-0 w-full bg-gray-800 dark:bg-gray-900 border-t border-gray-700 dark:border-gray-800 py-3 z-50">
        <div class="flex items-center justify-center gap-2 text-sm text-gray-200">
            <span class="text-primary">GO API Whatsapp</span>
            <span class="group relative cursor-help">
                <span class="group-hover:hidden">Time GO</span>
                <span class="hidden group-hover:inline"><strong> Nakamura</strong> / <strong>Joceilton Gomes</strong> / <strong>Augusto Oliveira</strong> / <strong>Othon Righetti</strong></span>
            </span>
        </div>
    </footer>  

    <script>
        // Theme toggle functionality
        const themeToggle = document.getElementById('theme-toggle');
        const html = document.documentElement;

        // Check for saved theme preference or default to 'dark'
        const currentTheme = localStorage.getItem('theme') || 'dark';
        html.classList.toggle('dark', currentTheme === 'dark');

        themeToggle.addEventListener('click', () => {
            html.classList.toggle('dark');
            const newTheme = html.classList.contains('dark') ? 'dark' : 'light';
            localStorage.setItem('theme', newTheme);
        });

        // Language toggle functionality
        const translations = {
            'pt': {
                'page-title': 'Conectar Instância #42',
                'page-subtitle': 'Escaneie o código QR abaixo para vincular sua conta do WhatsApp a esta instância da API.',
                'instructions-title': 'Instruções',
                'instructions-subtitle': 'Siga estes passos no seu dispositivo móvel:',
                'step1-title': 'Abrir WhatsApp',
                'step1-desc': 'Abra o WhatsApp no seu celular.',
                'step2-title': 'Ir para Configurações',
                'step2-desc': 'Toque em <span class="font-bold">Menu</span> no Android ou <span class="font-bold">Configurações</span> no iOS.',
                'step3-title': 'Selecionar Aparelhos Conectados',
                'step3-desc': 'Toque em <span class="font-bold">Aparelhos Conectados</span> e depois em <span class="font-bold">Conectar Aparelho</span>.',
                'step4-title': 'Escanear Código QR',
                'step4-desc': 'Aponte seu telefone para esta tela para capturar o código.',
                'qr-title': 'Código QR',
                'status-waiting': 'Aguardando conexão...',
                'reload-qr': 'Recarregar QR Code',
                'tip': 'Dica: Mantenha seu telefone conectado à internet.',
                'help-link': 'Precisa de ajuda? Confira nosso guia de solução de problemas de conexão.',
                'status-badge': 'Desconectado'
            },
            'en': {
                'page-title': 'Connect Instance #42',
                'page-subtitle': 'Scan the QR code below to link your WhatsApp account to this API instance.',
                'instructions-title': 'Instructions',
                'instructions-subtitle': 'Follow these steps on your mobile device:',
                'step1-title': 'Open WhatsApp',
                'step1-desc': 'Open WhatsApp on your mobile phone.',
                'step2-title': 'Go to Settings',
                'step2-desc': 'Tap <span class="font-bold">Menu</span> on Android or <span class="font-bold">Settings</span> on iOS.',
                'step3-title': 'Select Linked Devices',
                'step3-desc': 'Tap on <span class="font-bold">Linked Devices</span> and then <span class="font-bold">Link a Device</span>.',
                'step4-title': 'Scan QR Code',
                'step4-desc': 'Point your phone at this screen to capture the code.',
                'qr-title': 'QR Code',
                'status-waiting': 'Waiting for connection...',
                'reload-qr': 'Reload QR Code',
                'tip': 'Tip: Keep your phone connected to the internet.',
                'help-link': 'Need help? Check our connection troubleshooting guide.',
                'status-badge': 'Disconnected'
            },
            'es': {
                'page-title': 'Conectar Instancia #42',
                'page-subtitle': 'Escanea el código QR a continuación para vincular tu cuenta de WhatsApp a esta instancia de API.',
                'instructions-title': 'Instrucciones',
                'instructions-subtitle': 'Sigue estos pasos en tu dispositivo móvil:',
                'step1-title': 'Abrir WhatsApp',
                'step1-desc': 'Abre WhatsApp en tu teléfono móvil.',
                'step2-title': 'Ir a Configuración',
                'step2-desc': 'Toca <span class="font-bold">Menú</span> en Android o <span class="font-bold">Configuración</span> en iOS.',
                'step3-title': 'Seleccionar Dispositivos Vinculados',
                'step3-desc': 'Toca en <span class="font-bold">Dispositivos Vinculados</span> y luego en <span class="font-bold">Vincular Dispositivo</span>.',
                'step4-title': 'Escanear Código QR',
                'step4-desc': 'Apunta tu teléfono a esta pantalla para capturar el código.',
                'qr-title': 'Código QR',
                'status-waiting': 'Esperando conexión...',
                'reload-qr': 'Recargar Código QR',
                'tip': 'Consejo: Mantén tu teléfono conectado a internet.',
                'help-link': '¿Necesitas ayuda? Consulta nuestra guía de solución de problemas de conexión.',
                'status-badge': 'Desconectado'
            }
        };

        const languageToggle = document.getElementById('language-toggle');
        const languageDropdown = document.getElementById('language-dropdown');
        const currentLangText = document.getElementById('current-lang-text');
        let currentLanguage = localStorage.getItem('language') || 'pt';

        const languageNames = {
            'pt': 'Português',
            'en': 'English',
            'es': 'Español'
        };

        function changeLanguage(lang) {
            currentLanguage = lang;
            localStorage.setItem('language', lang);
            currentLangText.textContent = languageNames[lang];
            
            // Update all translatable elements
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                if (translations[lang][key]) {
                    element.innerHTML = translations[lang][key];
                }
            });
            
            // Close dropdown
            languageDropdown.classList.add('hidden');
        }

        // Toggle dropdown
        languageToggle.addEventListener('click', () => {
            languageDropdown.classList.toggle('hidden');
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', (e) => {
            if (!languageToggle.contains(e.target) && !languageDropdown.contains(e.target)) {
                languageDropdown.classList.add('hidden');
            }
        });

        // Function to select language (called from dropdown buttons)
        function selectLanguage(lang) {
            changeLanguage(lang);
        }

        // Initialize language
        changeLanguage(currentLanguage);

        // Auth & Config
        if (!localStorage.getItem('user_token')) {
            window.location.href = 'login.html';
        }
        
        // Usar configuração global
        const API_CONFIG = window.GO_API_CONFIG || {
            baseUrl: window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
                ? 'http://localhost:4000/api'
                : `${window.location.protocol}//${window.location.host}/api`,
            apiKey: 'change-this-key'
        };

        // QR Code Logic
        const urlParams = new URLSearchParams(window.location.search);
        const instanceId = urlParams.get('instance');
        const qrContainer = document.querySelector('.bg-white.p-4.rounded-lg.shadow-sm'); // Container da imagem do QR
        
        if (!instanceId) {
            showError('Instância não especificada', 'Erro');
            setTimeout(() => {
                window.location.href = 'instancia.html';
            }, 2000);
        } else {
            document.querySelector('[data-i18n="page-title"]').textContent = `Conectar ${instanceId}`;
            // Substituir a imagem estática pela div onde o qrcode.js vai renderizar
            qrContainer.innerHTML = '<div id="qrcode"></div>';
        }

        let qrCodeObj = null;
        let checkConnectionInterval = null;
        let connectionCheckCount = 0;

        // Função para compartilhar link
        function shareQRLink() {
            const shareUrl = `${window.location.origin}/qr-share.html?instance=${encodeURIComponent(instanceId)}`;
            
            // Tentar usar a API de compartilhamento nativa
            if (navigator.share) {
                navigator.share({
                    title: 'Conectar WhatsApp - GO API',
                    text: `Conecte a instância ${instanceId} ao WhatsApp`,
                    url: shareUrl
                }).then(() => {
                    showSuccess('Link compartilhado com sucesso!');
                }).catch((error) => {
                    if (error.name !== 'AbortError') {
                        copyToClipboard(shareUrl);
                    }
                });
            } else {
                // Fallback: copiar para clipboard
                copyToClipboard(shareUrl);
            }
        }

        function copyToClipboard(text) {
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text).then(() => {
                    showSuccess('Link copiado para a área de transferência!', 'Sucesso');
                }).catch(() => {
                    fallbackCopyToClipboard(text);
                });
            } else {
                fallbackCopyToClipboard(text);
            }
        }

        function fallbackCopyToClipboard(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            document.body.appendChild(textArea);
            textArea.select();
            try {
                document.execCommand('copy');
                showSuccess('Link copiado para a área de transferência!', 'Sucesso');
            } catch (err) {
                showError('Não foi possível copiar o link', 'Erro');
            }
            document.body.removeChild(textArea);
        }

        // Atualizar status visual
        function updateQRStatus(status, message) {
            const statusEl = document.getElementById('qr-status');
            if (!statusEl) return;

            if (status === 'waiting') {
                statusEl.innerHTML = '<span class="relative flex h-3 w-3">' +
                    '<span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>' +
                    '<span class="relative inline-flex rounded-full h-3 w-3 bg-green-500"></span>' +
                    '</span>' +
                    '<p class="text-sm font-medium">' + message + '</p>';
            } else if (status === 'connected') {
                statusEl.innerHTML = '<span class="relative flex h-3 w-3">' +
                    '<span class="relative inline-flex rounded-full h-3 w-3 bg-green-500"></span>' +
                    '</span>' +
                    '<p class="text-sm font-medium text-green-600 dark:text-green-400">' + message + '</p>';
            } else if (status === 'error') {
                statusEl.innerHTML = '<span class="relative flex h-3 w-3">' +
                    '<span class="relative inline-flex rounded-full h-3 w-3 bg-red-500"></span>' +
                    '</span>' +
                    '<p class="text-sm font-medium text-red-600 dark:text-red-400">' + message + '</p>';
            }
        }

        async function updateQR() {
            try {
                // Verificar status primeiro
                const statusRes = await fetch(`${API_CONFIG.baseUrl}/instances/${instanceId}/status`, {
                    headers: { 'x-api-key': API_CONFIG.apiKey }
                });
                const statusData = await statusRes.json();

                if (statusData.success && statusData.data.isConnected) {
                    // QR Code foi lido!
                    updateQRStatus('connected', '✓ QR Code lido com sucesso!');
                    
                    // Parar verificações
                    if (checkConnectionInterval) {
                        clearInterval(checkConnectionInterval);
                    }
                    
                    // Mostrar alerta de sucesso
                    showSuccess('WhatsApp conectado com sucesso! Esta página será fechada em 10 segundos...', 'Conectado!');
                    
                    // Countdown visual
                    let countdown = 10;
                    const countdownInterval = setInterval(() => {
                        countdown--;
                        if (countdown > 0) {
                            updateQRStatus('connected', `✓ Conectado! Fechando em ${countdown}s...`);
                        } else {
                            clearInterval(countdownInterval);
                            window.location.href = 'instancia.html';
                        }
                    }, 1000);
                    
                    return;
                }

                // Buscar QR Code
                const qrRes = await fetch(`${API_CONFIG.baseUrl}/instances/${instanceId}/qr`, {
                    headers: { 'x-api-key': API_CONFIG.apiKey }
                });
                const qrData = await qrRes.json();

                if (qrData.success && qrData.data.qrCode) {
                    const qrElement = document.getElementById('qrcode');
                    if (qrElement) {
                        qrElement.innerHTML = '';
                        
                        new QRCode(qrElement, {
                            text: qrData.data.qrCode,
                            width: 250,
                            height: 250,
                            colorDark: "#000000",
                            colorLight: "#ffffff",
                            correctLevel: QRCode.CorrectLevel.H
                        });
                        
                        updateQRStatus('waiting', 'Aguardando leitura...');
                    }
                } else {
                    // Se não tem QR, pode estar inicializando
                    updateQRStatus('waiting', 'Inicializando instância...');
                }
            } catch (error) {
                console.error('Erro ao buscar QR/Status:', error);
                updateQRStatus('error', 'Erro de conexão com API');
            }
        }

        // Event listeners
        const shareBtn = document.getElementById('share-qr-btn');
        if (shareBtn) {
            shareBtn.addEventListener('click', shareQRLink);
        }

        const reloadBtn = document.getElementById('reload-qr-btn');
        if (reloadBtn) {
            reloadBtn.addEventListener('click', () => {
                updateQRStatus('waiting', 'Recarregando...');
                updateQR();
            });
        }

        // Verificar conexão a cada 3 segundos (mais rápido para detectar leitura)
        checkConnectionInterval = setInterval(updateQR, 3000);
        updateQR(); // Primeira chamada imediata
    </script>
</body>

</html>